### Serverless 概念
通常意义上来讲，Serverless 可以看作是一种云计算服务模型，它允许开发者在不需要管理服务器的情况下通过事件驱动的方式运行代码。与传统应用服务开发模式不同，开发者只需编写并上传他们的应用代码到云服务商提供的平台上，云平台会自动为应用分配资源，并处理应用的部署、扩缩容。这使得开发者可以更加专注于自己的业务需求和应用逻辑，而不需要考虑服务资源的申请、创建、管理和维护等。从这个意义上讲，我们也可以认为Serverless是一个计算范式，它解决资源托管、调度、运维管理等一系列平台型问题，可以看作是DevOps的进一步延伸。

从应用开发视角来看，Serverless包括FaaS (Function as a Service) 和 BaaS (Backend as a Service) 两部分。在FaaS中，开发者编写的代码会被封装成一个或多个函数，运行在云平台上。当请求到达时，云平台自动为函数分配计算资源，拉起函数并执行。执行完成后，平台根据一定的保活策略决定资源的复用或者释放。FaaS模型不仅可以提高应用的可伸缩性和弹性，还可以大幅降低应用运维的成本。BaaS则致力于更广泛意义下的Serverless化，包括对象存储、缓存、数据库、消息等全栈后端服务的按需弹性、按用付费等。

Serverless，它是云计算发展过程中出现的一种计算资源的抽象，依赖第三方服务，开发者可以更加专注的开发自己的业务代码，而无需关心底层资源的分配、扩容和部署。

特点：

1. 开发者只需要专注于业务，无需关心底层资源的分配、扩容和部署
2. 按需使用和收费
3. 自动扩缩容

### Serverless + SSR

结合 Serverless 和 SSR 的特点，我们可以发现他们简直是天作之合。借助 Serverless，前端团队无需关注 SSR 服务器的部署、运维和扩容，可以极大地减少部署运维成本，更好的聚焦业务开发，提高开发效率。

同时也无需关心 SSR 服务器的性能问题，理论上 Serverless 是可以无限扩容的（当然云厂商对于一般用户是有扩容上限的）。

### 如何快速将 SSR 应用 Serverless 化？

既然说 Serverless 对于 SSR 来说有天然的优势，那么我们如何将 SSR 应用迁移到Serverless 架构上呢？

本文将以 Next.js 框架为例，带大家快速体验部署一个 Serverless SSR 应用。

#### Serverless + Next.js 部署流程图

优化后项目整体部署流程图如下：

![[Pasted image 20240219160017.png]]

### Serverless 和 服务器方案 对比分析

从单用户访问页面性能表现来看 `Serverless 方案略逊于服务器方案`，但是页面性能指标是可以优化的。从压测来看，虽然 Serverless 的 `平均响应时间` 略大于 CVM，但是 `最大响应时间` 和 `P95耗时` 均优于 CVM 很多，CVM 的最大响应时间甚至接近 Serverless 的 `3倍`。而且当并发量逐渐增大时，CVM 的响应时间变化明显，而且越来越大，而 Serverless 则表现平稳，除了极个别的冷启动，基本能在 `200ms` 以内。

由此可以看出，随着并发的增加，SSR 会导致服务器负荷越来越大，从而会加大服务器的响应时间；而 Serverless 由于具有自动扩缩的能力，所以相对比较平稳。

当然由于测试条件有限，可能会有考虑不够全面的地方，但是从压测图形来看，是完全符合理论预期的。

但是从价格对比来看，接近配置的 Serverless 方案基本不怎么花钱，甚至很多时候，免费额度就已经可以满足需求了，这里为了增加 Serverless 费用，估计调大了调用次数，内存大小，但是即便如此，服务器方案还是接近 Serverless 方案的 10 倍!!!!!。

### 最后

作为一名前端开发，内心是无比激动的。记得以前在项目中为了优化首屏时间和 SEO，就做个好几个方案的对比，但是最终因为公司运维团队的不够配合，最后放弃了 SSR，最后选择了前端可掌控的 `预渲染方案`。现在有了 Serverless，前端终于不用受运维的限制，可以基于 Serverless 来大胆的尝试 SSR。而且借助 Serverless，前端还可以做的更多。

当然真正的 SSR 并不止如此，要达到页面极致体验我们还需要做很多工作，比如：

1. 静态资源部署到 CDN
2. 页面缓存
3. 降级处理
4. ...

但是这些无论是部署到服务器还是 Serverless，都是我们需要做的工作。并不会成为我们将 SSR 部署到 Serverless 的绊脚石。